<!DOCTYPE html>
<html>
<head>	
	<meta charset="UTF-8" >
    <!-- Adaptación a dispositivos móviles -->
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />    
 	<title>Hispania Romana</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <!-- CSS estilo -->
    <link rel="stylesheet" href="CSS/estilo_tamanios.css"/>
    <!-- GeoJSON -->
    <script type="text/javascript" src="JS/ProvinciasRomanas.js"></script>
	<script type="text/javascript" src="JS/areaTweet.js"></script>
    <script type="text/javascript" src="JS/capitalesromanas.js"></script>
    <script type="text/javascript" src="JS/yacimientos.js"></script>
    <script type="text/javascript" src="JS/Twitters.js"></script>
    <!-- esri -->
    <script src="https://unpkg.com/esri-leaflet@2.0.8"></script>
    <!--MarkerCluster -->
    <link rel="stylesheet" href="Plugins/MarkerCluster/MarkerCluster.css" />
    <link rel ="stylesheet" href="Plugins/MarkerCluster/MarkerCluster.Default.css"/>
    <script src="Plugins/MarkerCluster/leaflet.markercluster.js"></script>
    <!--Búsquedas -->
    <script src ="Plugins/Search/src/leaflet-search.js"></script>
    <link rel="stylesheet" href ="Plugins/Search/src/leaflet-search.css">
    <!--Imprimir -->
    <script src="Plugins/Print/Bundle.js"></script>
    <!-- Control de capas -->
    <script src="Plugins/StyledLayer/src/styledLayerControl.js"></script>
    <link rel="stylesheet" href="Plugins/StyledLayer/css/styledLayerControl.css">
    <!-- Agregar la fuente Caesar+Dressing  -->
    <link href="https://fonts.googleapis.com/css?family=Caesar+Dressing" rel="stylesheet">
    <!-- Plugin Sidebar -->
    <script src="Plugins/Sidebar/L.Control.Sidebar.js"></script>
    <link rel="stylesheet" href="Plugins/Sidebar/L.Control.Sidebar.css">    

</head>
<body>
    
    <div id= "header"> Hispania Romana </div>
    <div id="map"></div> 
    
    <script>
        var map = L.map('map',{center: [40.418889, -3.691944], zoom: 6});          
        var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'});        

        var cap_prov = L.geoJson(capitales,{onEachFeature:function(feature, layer){ layer.bindPopup ("<h2>"+feature.properties.Provincia+" </h2> <h4>"+feature.properties.capital+"</h4> <figure> <img src =Datos/"+feature.properties.foto+"> </figure> <h5> <a href="+feature.properties.link+" target=_blank>Más información <a></h5>"); } });
		
        function ventana(feature,layer){layer.bindPopup("<h3>Provincia:"+feature.properties.NOMBRE+"</h3>");};
        
        //Función para dar estilo al polígono de cada provincia en función de la propiedad nombre del archivo GeoJSON
        function funcionestilo(feature) {
        switch (feature.properties.NOMBRE) {
            case 'Baetica': return {fillColor: "#1b9e77","color":"black","opacity": 0.7, "weight": 3, "dashArray": '7', "fillOpacity": 0.5};
            case 'Tarraconensis': return {fillColor: "#d95f02", "color":"black", "opacity": 0.7, "weight": 3, "dashArray": '7', "fillOpacity": 0.5};
            case 'Lusitania': return {fillColor: "#7570b3","color":"black","opacity": 0.7, "weight": 3, "dashArray": '7', "fillOpacity": 0.5};
			case 'tweetensis': return {fillColor: "#FFFFFF","color":"black","opacity": 0.7, "weight": 3, "dashArray": '7', "fillOpacity": 0.5};
            }
        };

        var marcadores = L.markerClusterGroup();
		var marcadores2 = L.markerClusterGroup();
        var cap_tweets = marcadores2.addLayer(L.geoJSON(tweets,{onEachFeature:function(feature, layer){ layer.bindPopup ("<h2>"+feature.properties.Nombre+" </h2> <h4>"+feature.properties.Tipo+"</h4> <h4>"+feature.properties.Pais+"</h4>"); } }));
        var capa_yacimientos = marcadores.addLayer(L.geoJSON(datos, {onEachFeature: function (feature, layer) {
            layer.bindPopup("<h3> Nombre del yacimiento:" +feature.properties.Nombre+" </h3><li> Tipo: "+feature.properties.Tipo+"</li><li> Tipo de Provincia: "+feature.properties.Tip_Prov+"</li><li>Provincia :"+feature.properties.Provincia+"</li>"); } }));
        
        //Creamos nuevas capas ESRI para ver el resultado de la organización de capas mediante styledLayerControl
        var ESRI_NG = L.esri.basemapLayer('NationalGeographic');
        var ESRI_T = L.esri.basemapLayer('Topographic');
        var ESRI_DG = L.esri.basemapLayer('DarkGray');
        var Hispania = L.imageOverlay("Datos/Hispania.jpg", [[35.247,-11.050], [44.506,5.047]], {opacity:0.5});        
        
        var ESRI = L.esri.basemapLayer('Imagery').addTo(map);
        var rom_prov = L.geoJSON(provincias, {onEachFeature:ventana, style:funcionestilo}).addTo(map);
		var area_tweet = L.geoJSON(areaTweet, {onEachFeature:ventana, style:funcionestilo}).addTo(map);
                
        //Creamos los grupos de capas para el nuevo control de capas mediante styledLayerControl
        var overlays = [ {
            groupName : "Yacimientos Romanos",
            layers : { "Capitales de provincias": cap_prov, "Yacimientos" : capa_yacimientos, "tweets": cap_tweets
        }},
		{
            groupName : "Areas tweets",
            layers : { "tweets": area_tweet
        }},		
        {
            groupName : "Provincias Romanas",
            layers : { "Provincias Romanas GeoJSON" : rom_prov, "Mapa Antiguo" : Hispania
        } }];
        
        var baseMaps = [ {
            groupName : "Mapa Base OSM",
            layers : {"Open Stret Map" : osm
        }},
        {
            groupName : "Mapa Base ESRI",
            layers : { "NationalGeographic" : ESRI_NG, "Topographic" : ESRI_T, "Imagery" : ESRI, "DarkGary": ESRI_DG
        }
        },];
        
        //Variable para dar formato al control de capas
        var options = {
            container_width : "250px",
            group_maxHeight : "80px",
            exclusive : false,
            collapsed : true,
            position: 'topright'
        };
        //Añadimos el nuevo control de capas mediante el siguiente código:
        var capas= L.Control.styledLayerControl(baseMaps, overlays, options);
        map.addControl(capas);        

        //Creamos y añadimos el objeto buscar_marcador. Será un buscador de capa_yacimientos
        var buscar_marcador = new L.Control.Search({
            position: 'topleft',
            initial: false,
            textPlaceholder: 'Buscar yacimiento',
            layer: capa_yacimientos,
            propertyName: 'Nombre',
            circleLocation:true,
            collapsed: true
        });
        map.addControl(buscar_marcador);        

        
        //Escala
        L.control.scale({position:'bottomleft',metric: true,imperial: false, maxWidth: 100}).addTo(map);        
    </script>
</body>
</html>